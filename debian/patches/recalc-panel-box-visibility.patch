Origin: Commit ec7a66a90cc38afe32d1ee805f4f06a9b722a10b
Forwarded: No
Author: David Mohammed <fossfreedom@ubuntu.com>
Last-Update: 2019-12-31
Description: [PATCH] Recalculate panel box visibility on applet change
 This is a Debian only patch since it is primarily to support a Debian
 third-party applet budgie-appmenu-applet

---
 src/panel/panel.vala | 23 ++++++++++++++++++++---
 1 file changed, 20 insertions(+), 3 deletions(-)

diff --git a/src/panel/panel.vala b/src/panel/panel.vala
index ce64fe93..5b1ac30a 100644
--- a/src/panel/panel.vala
+++ b/src/panel/panel.vala
@@ -1,8 +1,8 @@
 /*
  * This file is part of budgie-desktop
- * 
+ *
  * Copyright Â© 2015-2019 Budgie Desktop Developers
- * 
+ *
  * This program is free software; you can redistribute it and/or modify
  * it under the terms of the GNU General Public License as published by
  * the Free Software Foundation; either version 2 of the License, or
@@ -19,7 +19,7 @@ namespace Budgie
  */
 public class MainPanel : Gtk.Box
 {
- 
+
     public MainPanel()
     {
         Object(orientation: Gtk.Orientation.HORIZONTAL);
@@ -144,6 +144,18 @@ public class Panel : Budgie.Toplevel
         return false;
     }
 
+    private void panel_box_visibility()
+    {
+        Gtk.Box[] boxarray = { start_box, center_box, end_box };
+        foreach (var box in boxarray) {
+            bool visible = true;
+            if (box.get_children().length() == 0) {
+                visible = false;
+            }
+            box.set_visible(visible);
+        }
+    }
+
     /**
      * Force update the geometry
      */
@@ -375,6 +387,7 @@ public class Panel : Budgie.Toplevel
         /* bit of a no-op. */
         update_sizes();
         load_applets();
+        this.applets_changed.connect(this.panel_box_visibility);
     }
 
     void do_size_allocate()
@@ -727,6 +740,7 @@ public class Panel : Budgie.Toplevel
 
         set_applets();
         budge_em_left(alignment, position);
+        panel_box_visibility();
     }
 
     void add_applet(Budgie.AppletInfo? info)
@@ -775,6 +789,7 @@ public class Panel : Budgie.Toplevel
         ulong id = info.notify.connect(applet_updated);
         info.set_data("notify_id", id);
         this.applet_added(info);
+        panel_box_visibility();
 
         if (this.is_fully_loaded) {
             return;
@@ -1557,6 +1572,8 @@ public class Panel : Budgie.Toplevel
     {
         show_panel_id = 0;
 
+        panel_box_visibility();
+
         if (!this.allow_animation) {
             return false;
         }
-- 
2.17.1

